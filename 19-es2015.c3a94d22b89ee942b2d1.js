(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{"/yFf":function(t,e,r){"use strict";var n=r("oHnp");function s(t){if(t)return function(t){for(var e in s.prototype)t[e]=s.prototype[e];return t}(t)}t.exports=s,s.prototype.get=function(t){return this.header[t.toLowerCase()]},s.prototype._setHeaderProperties=function(t){var e=t["content-type"]||"";this.type=n.type(e);var r=n.params(e);for(var s in r)this[s]=r[s];this.links={};try{t.link&&(this.links=n.parseLinks(t.link))}catch(i){}},s.prototype._setStatusProperties=function(t){var e=t/100|0;this.status=this.statusCode=t,this.statusType=e,this.info=1==e,this.ok=2==e,this.redirect=3==e,this.clientError=4==e,this.serverError=5==e,this.error=(4==e||5==e)&&this.toError(),this.created=201==t,this.accepted=202==t,this.noContent=204==t,this.badRequest=400==t,this.unauthorized=401==t,this.notAcceptable=406==t,this.forbidden=403==t,this.notFound=404==t,this.unprocessableEntity=422==t}},"24Ii":function(t,e,r){var n;"undefined"!=typeof window?n=window:"undefined"!=typeof self?n=self:(console.warn("Using browser-only version of superagent in non-browser environment"),n=this);var s=r("cpc2"),i=r("kMlx"),o=r("8zgK"),a=r("/yFf"),l=r("nZbv");function c(){}var u=e=t.exports=function(t,r){return"function"==typeof r?new e.Request("GET",t).end(r):1==arguments.length?new e.Request("GET",t):new e.Request(t,r)};e.Request=E,u.getXHR=function(){if(!(!n.XMLHttpRequest||n.location&&"file:"==n.location.protocol&&n.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}throw Error("Browser-only version of superagent could not find XHR")};var h="".trim?function(t){return t.trim()}:function(t){return t.replace(/(^\s*|\s*$)/g,"")};function d(t){if(!o(t))return t;var e=[];for(var r in t)f(e,r,t[r]);return e.join("&")}function f(t,e,r){if(null!=r)if(Array.isArray(r))r.forEach(function(r){f(t,e,r)});else if(o(r))for(var n in r)f(t,e+"["+n+"]",r[n]);else t.push(encodeURIComponent(e)+"="+encodeURIComponent(r));else null===r&&t.push(encodeURIComponent(e))}function p(t){for(var e,r,n={},s=t.split("&"),i=0,o=s.length;i<o;++i)-1==(r=(e=s[i]).indexOf("="))?n[decodeURIComponent(e)]="":n[decodeURIComponent(e.slice(0,r))]=decodeURIComponent(e.slice(r+1));return n}function g(t){return/[\/+]json($|[^-\w])/.test(t)}function y(t){this.req=t,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||void 0===this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var e=this.xhr.status;1223===e&&(e=204),this._setStatusProperties(e),this.header=this.headers=function(t){for(var e,r,n,s,i=t.split(/\r?\n/),o={},a=0,l=i.length;a<l;++a)-1!==(e=(r=i[a]).indexOf(":"))&&(n=r.slice(0,e).toLowerCase(),s=h(r.slice(e+1)),o[n]=s);return o}(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),this.body=null===this.text&&t._responseType?this.xhr.response:"HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function E(t,e){var r=this;this._query=this._query||[],this.method=t,this.url=e,this.header={},this._header={},this.on("end",function(){var t,e=null,n=null;try{n=new y(r)}catch(s){return(e=new Error("Parser is unable to parse the response")).parse=!0,e.original=s,r.xhr?(e.rawResponse=void 0===r.xhr.responseType?r.xhr.responseText:r.xhr.response,e.status=r.xhr.status?r.xhr.status:null,e.statusCode=e.status):(e.rawResponse=null,e.status=null),r.callback(e)}r.emit("response",n);try{r._isResponseOK(n)||(t=new Error(n.statusText||"Unsuccessful HTTP response"))}catch(i){t=i}t?(t.original=e,t.response=n,t.status=n.status,r.callback(t,n)):r.callback(null,n)})}function _(t,e,r){var n=u("DELETE",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n}u.serializeObject=d,u.parseString=p,u.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},u.serialize={"application/x-www-form-urlencoded":d,"application/json":JSON.stringify},u.parse={"application/x-www-form-urlencoded":p,"application/json":JSON.parse},a(y.prototype),y.prototype._parseBody=function(t){var e=u.parse[this.type];return this.req._parser?this.req._parser(this,t):(!e&&g(this.type)&&(e=u.parse["application/json"]),e&&t&&(t.length||t instanceof Object)?e(t):null)},y.prototype.toError=function(){var t=this.req,e=t.method,r=t.url,n=new Error("cannot "+e+" "+r+" ("+this.status+")");return n.status=this.status,n.method=e,n.url=r,n},u.Response=y,s(E.prototype),i(E.prototype),E.prototype.type=function(t){return this.set("Content-Type",u.types[t]||t),this},E.prototype.accept=function(t){return this.set("Accept",u.types[t]||t),this},E.prototype.auth=function(t,e,r){1===arguments.length&&(e=""),"object"==typeof e&&null!==e&&(r=e,e=""),r||(r={type:"function"==typeof btoa?"basic":"auto"});var n=function(t){if("function"==typeof btoa)return btoa(t);throw new Error("Cannot use basic auth, btoa is not a function")};return this._auth(t,e,r,n)},E.prototype.query=function(t){return"string"!=typeof t&&(t=d(t)),t&&this._query.push(t),this},E.prototype.attach=function(t,e,r){if(e){if(this._data)throw Error("superagent can't mix .send() and .attach()");this._getFormData().append(t,e,r||e.name)}return this},E.prototype._getFormData=function(){return this._formData||(this._formData=new n.FormData),this._formData},E.prototype.callback=function(t,e){if(this._shouldRetry(t,e))return this._retry();var r=this._callback;this.clearTimeout(),t&&(this._maxRetries&&(t.retries=this._retries-1),this.emit("error",t)),r(t,e)},E.prototype.crossDomainError=function(){var t=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");t.crossDomain=!0,t.status=this.status,t.method=this.method,t.url=this.url,this.callback(t)},E.prototype.buffer=E.prototype.ca=E.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},E.prototype.pipe=E.prototype.write=function(){throw Error("Streaming is not supported in browser version of superagent")},E.prototype._isHost=function(t){return t&&"object"==typeof t&&!Array.isArray(t)&&"[object Object]"!==Object.prototype.toString.call(t)},E.prototype.end=function(t){return this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=t||c,this._finalizeQueryString(),this._end()},E.prototype._end=function(){var t=this,e=this.xhr=u.getXHR(),r=this._formData||this._data;this._setTimeouts(),e.onreadystatechange=function(){var r=e.readyState;if(r>=2&&t._responseTimeoutTimer&&clearTimeout(t._responseTimeoutTimer),4==r){var n;try{n=e.status}catch(s){n=0}if(!n){if(t.timedout||t._aborted)return;return t.crossDomainError()}t.emit("end")}};var n=function(e,r){r.total>0&&(r.percent=r.loaded/r.total*100),r.direction=e,t.emit("progress",r)};if(this.hasListeners("progress"))try{e.onprogress=n.bind(null,"download"),e.upload&&(e.upload.onprogress=n.bind(null,"upload"))}catch(a){}try{this.username&&this.password?e.open(this.method,this.url,!0,this.username,this.password):e.open(this.method,this.url,!0)}catch(l){return this.callback(l)}if(this._withCredentials&&(e.withCredentials=!0),!this._formData&&"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof r&&!this._isHost(r)){var s=this._header["content-type"],i=this._serializer||u.serialize[s?s.split(";")[0]:""];!i&&g(s)&&(i=u.serialize["application/json"]),i&&(r=i(r))}for(var o in this.header)null!=this.header[o]&&this.header.hasOwnProperty(o)&&e.setRequestHeader(o,this.header[o]);return this._responseType&&(e.responseType=this._responseType),this.emit("request",this),e.send(void 0!==r?r:null),this},u.agent=function(){return new l},["GET","POST","OPTIONS","PATCH","PUT","DELETE"].forEach(function(t){l.prototype[t.toLowerCase()]=function(e,r){var n=new u.Request(t,e);return this._setDefaults(n),r&&n.end(r),n}}),l.prototype.del=l.prototype.delete,u.get=function(t,e,r){var n=u("GET",t);return"function"==typeof e&&(r=e,e=null),e&&n.query(e),r&&n.end(r),n},u.head=function(t,e,r){var n=u("HEAD",t);return"function"==typeof e&&(r=e,e=null),e&&n.query(e),r&&n.end(r),n},u.options=function(t,e,r){var n=u("OPTIONS",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n},u.del=_,u.delete=_,u.patch=function(t,e,r){var n=u("PATCH",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n},u.post=function(t,e,r){var n=u("POST",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n},u.put=function(t,e,r){var n=u("PUT",t);return"function"==typeof e&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n}},"2k3W":function(t,e,r){"use strict";r.r(e),r.d(e,"bits",function(){return s}),r.d(e,"buffer",function(){return _}),r.d(e,"byte",function(){return m}),r.d(e,"integer",function(){return w}),r.d(e,"nibble",function(){return v}),r.d(e,"string",function(){return R});for(var n=function(t){for(var e=[],r=0;r<t.length;r++)e[r]=1^t[r];return e},s={and:function(t,e){for(var r=[],n=0;n<t.length;n++)r[n]=t[n]&e[n];return r},nand:function(t,e){for(var r=[],n=0;n<t.length;n++)r[n]=t[n]&e[n]^1;return r},nor:function(t,e){for(var r=[],n=0;n<t.length;n++)r[n]=1^(t[n]|e[n]);return r},not:n,or:function(t,e){for(var r=[],n=0;n<t.length;n++)r[n]=t[n]|e[n];return r},reduceAnd:function(t){if(t.length<2)throw new RangeError("Not enough bits.");for(var e=t[0],r=1;r<t.length;r++)e&=t[r];return e},reduceNand:function(t){if(t.length<2)throw new RangeError("Not enough bits.");for(var e=t[0],r=1;r<t.length;r++)e=e&t[r]^1;return e},reduceNor:function(t){if(t.length<2)throw new RangeError("Not enough bits.");for(var e=t[0],r=1;r<t.length;r++)e=1^(e|t[r]);return e},reduceOr:function(t){if(t.length<2)throw new RangeError("Not enough bits.");for(var e=t[0],r=1;r<t.length;r++)e|=t[r];return e},reduceXnor:function(t){if(t.length<2)throw new RangeError("Not enough bits.");for(var e=t[0],r=1;r<t.length;r++)e^=1^t[r];return e},reduceXor:function(t){if(t.length<2)throw new RangeError("Not enough bits.");for(var e=t[0],r=1;r<t.length;r++)e^=t[r];return e},toBoolean:function(t){for(var e=[],r=0;r<t.length;r++)e[r]=1===t[r];return e},toString:function(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=" "),!e)return t.join("");for(var n="",s=0;s<t.length;s++)n+=""+t[s],s%e==e-1&&s!==t.length-1&&(n+=r);return n},xnor:function(t,e){for(var r=[],n=0;n<t.length;n++)r[n]=t[n]^e[n]^1;return r},xor:function(t,e){for(var r=[],n=0;n<t.length;n++)r[n]=t[n]^e[n];return r}},i=r("XUzR"),o=r("GCxg"),a=r("G1u+"),l=function(t){if(t>255||t<0||~~t!==t)throw new RangeError("invalid byte");for(var e=[0,0,0,0,0,0,0,0],r=0;r<8;r++)e[7-r]=t>>r&1;return e},c=function(t,e,r){void 0===e&&(e=0),r||(r=8*t.length-e);var n=Math.floor(e/8),s=Math.floor(r/8)+2,i=[];i.length=8*s;for(var o=0;o<s;o++)if(void 0!==t[n+o]){var a=l(t[n+o]);i[8*o]=a[0],i[8*o+1]=a[1],i[8*o+2]=a[2],i[8*o+3]=a[3],i[8*o+4]=a[4],i[8*o+5]=a[5],i[8*o+6]=a[6],i[8*o+7]=a[7]}var c=e%8;return i.slice(c,c+r)},u=r("nMdu"),h=r("ILq/"),d=r("f7RY"),f=r("YnKP"),p=[],g=0;g<32;g++)p[g]=Math.pow(2,g);var y=r("vGFC"),E=r("5tNv"),_={and:i.a,create:o.a,modify:function(t,e,r){void 0===r&&(r=0);for(var n=Math.floor(r/8),s=Math.ceil((r+e.length)/8),i=t.slice(n,s),o=c(i),l=r%8,u=0;u<e.length;u++)o[l++]=e[u];for(var h=s-n,d=0;d<h;d++)i[d]=Object(a.a)(o.slice(8*d,8*(d+1)))},nand:u.a,nor:h.a,not:d.a,or:f.a,read:c,readInt:function(t,e,r){void 0===e&&(e=0),void 0===r&&(r=8);var s=c(t,e,r);if(0===s[0]){for(var i=0,o=0;o<r;o++)s[o]&&(i+=p[r-o-1]);return i}i=-1;var a=n(s);for(o=0;o<r;o++)a[o]&&(i-=p[r-o-1]);return i},readUInt:function(t,e,r){void 0===e&&(e=0),void 0===r&&(r=8);for(var n=c(t,e,r),s=0,i=0;i<r;i++)s+=n[i]*p[r-i-1];return s},xnor:y.a,xor:E.a},m={read:l,write:a.a},w={getBit:function(t,e){return t>>e&1},setBit:function(t,e,r){return 1===r?t|1<<e:t&~(1<<e)},toggleBit:function(t,e){return t^1<<e}},v={read:function(t){if(t<16&&t>=0&&Math.floor(t)===t){for(var e=[0,0,0,0],r=0;r<4;r++)e[3-r]=t>>r&1;return e}throw new RangeError("invalid array length")},write:function(t){if(!Array.isArray(t)||4!==t.length)throw new RangeError("invalid array length");for(var e=0,r=0;r<4;r++)t[3-r]&&(e|=1<<r);return e}},R={toBits:function(t){for(var e=[],r=0;r<t.length;r++)"1"===t[r]?e.push(1):"0"===t[r]&&e.push(0);return e}};e.default={bits:s,buffer:_,byte:m,integer:w,nibble:v,string:R}},"4Mn8":function(t,e,r){const n=r("pzNo");t.exports={Client:n}},"5tNv":function(t,e,r){"use strict";(function(t){e.a=function(e,r,n){void 0===n&&(n=!1);for(var s=n?r.length:e.length,i=t.alloc(s),o=0;o<s;o++)i[o]=e[n?o%e.length:o]^r[o];return i}}).call(this,r("tjlA").Buffer)},"6WMX":function(t,e,r){const n=r("B3Rj"),s=r("b3gk"),i=r("tjlA").Buffer,o=r("L21C"),a=i.from("01","hex"),{HARDENED_OFFSET:l}=r("L21C"),c=[44+l,l,l,1,0],u={LEGACY:0,SEGWIT:5,TESTNET:111,SEGWIT_TESTNET:196};e.addressVersion=u;const h={P2PKH:1,P2SH:2,P2SH_P2WPKH:3};function d(t,e){return i.concat([t,e])}function f(t){const e=i.alloc(4);return e.writeUInt32LE(t),e}function p(t){let e;return t<253?(e=i.alloc(1),e.writeUInt8(t)):t<=65535?(e=i.alloc(3),e.writeUInt8(253,0),e.writeUInt16LE(t,1)):t<4294967295?(e=i.alloc(5),e.writeUInt8(254,0),e.writeUInt32LE(t,1)):(e=i.alloc(9),e.writeUInt8(255,0),e.writeUInt32LE(t>>>0,1),e.writeUInt32LE(t/4294967296|0,5)),e}function g(t,e,r){"number"==typeof t&&(t=t.toString(16));const n=i.alloc(8),s=t.length%2==0?t.toString(16):`0${t.toString(16)}`;return i.from(s,"hex").reverse().copy(n,0),n.copy(e,r),n}e.scriptTypes=h,e.buildBitcoinTxRequest=function(t){try{const{prevOuts:e,recipient:r,value:a,changePath:l=c,fee:d,isSegwit:f,changeVersion:p="SEGWIT"}=t;if(5!==l.length)throw new Error("Please provide a full change path.");const y=i.alloc(59+69*e.length);let E=0;if(void 0===u[p])throw new Error("Invalid change version specified.");y.writeUInt8(u[p]),E++,y.writeUInt32LE(l.length,E),E+=4;for(let t=0;t<l.length;t++)y.writeUInt32LE(l[t],E),E+=4;y.writeUInt32LE(d,E),E+=4;const _=n.decode(r)[0],m=s.decode(r).slice(1);y.writeUInt8(_,E),E++,m.copy(y,E),E+=m.length,g(a,y,E),E+=8,y.writeUInt8(e.length,E),E++;let w=0;const v=!0===f?h.P2SH_P2WPKH:h.P2PKH;return e.forEach(t=>{if(!t.signerPath||5!==t.signerPath.length)throw new Error("Full recipient path not specified ");y.writeUInt32LE(t.signerPath.length,E),E+=4;for(let e=0;e<t.signerPath.length;e++)y.writeUInt32LE(t.signerPath[e],E),E+=4;y.writeUInt32LE(t.index,E),E+=4,g(t.value,y,E),E+=8,w+=t.value,y.writeUInt8(v,E),E++,i.isBuffer(t.txHash)||(t.txHash=i.from(t.txHash,"hex")),t.txHash.copy(y,E),E+=t.txHash.length}),{payload:y,schema:o.signingSchema.BTC_TRANSFER,origData:t,changeData:{changeVersion:p,value:w-(a+d)}}}catch(e){return{err:e}}},e.serializeTx=function(t){const{inputs:e,outputs:r,isSegwitSpend:o,lockTime:l=0,crypto:c}=t;let h=i.alloc(4),y=0;h.writeUInt32LE(2,y),y+=4,!0===o&&(h=d(h,i.from("00","hex")),h=d(h,i.from("01","hex")));const E=p(e.length);h=d(h,E),y+=E.length,e.forEach(t=>{h=d(h,t.hash.reverse()),y+=t.hash.length;const e=f(t.index);if(h=d(h,e),y+=e.length,!0===o){const e=function(t,e){const r=i.alloc(22),n=e.createHash("sha256").update(t).digest(),s=e.createHash("rmd160").update(n).digest();return r.writeUInt8(0),r.writeUInt8(s.length,1),s.copy(r,2),r}(t.pubkey,c),r=p(e.length),n=i.concat([r,e]),s=p(n.length);h=d(h,s),y+=s.length,h=d(h,n),y+=n.length}else{const e=function(t,e){const r=p((t=i.concat([t,a])).length),n=p(e.length),s=i.concat([r,t,n,e]),o=p(s.length);return i.concat([o,s])}(t.sig,t.pubkey);h=d(h,e),y+=e.length}const r=f(4294967295);h=d(h,r),y+=r.length});const _=p(r.length);if(h=d(h,_),y+=_.length,r.forEach(t=>{const e=function(t){const e=i.alloc(8);return g(t,e,0),e}(t.value);h=d(h,e),y+=e.length;const r=function(t){const e=n.decode(t)[0],r=s.decode(t).slice(1);return e===u.SEGWIT||e===u.SEGWIT_TESTNET?function(t){const e=i.alloc(3+t.length);let r=0;return e.writeUInt8(169,r),r++,e.writeUInt8(t.length,r),r++,t.copy(e,r),r+=t.length,e.writeUInt8(135,r),r++,e}(r):function(t){const e=i.alloc(5+t.length);let r=0;return e.writeUInt8(118,r),r++,e.writeUInt8(169,r),r++,e.writeUInt8(t.length,r),r++,t.copy(e,r),r+=t.length,e.writeUInt8(136,r),r++,e.writeUInt8(172,r),r++,e}(r)}(t.recipient),o=p(r.length);h=d(h,o),y+=o.length,h=d(h,r),y+=r.length}),!0===o){const t=[],r=[];for(let s=0;s<e.length;s++)t.push(e[s].sig),r.push(e[s].pubkey);const n=function(t,e){let r=i.alloc(0);const n=i.alloc(1);n.writeUInt8(2);for(let s=0;s<t.length;s++){const o=i.concat([t[s],a]),l=p(o.length),c=e[s],u=p(c.length);r=i.concat([r,n,l,o,u,c])}return r}(t,r);h=d(h,n),y+=n.length}return i.concat([h,f(l)]).toString("hex")},e.getBitcoinAddress=function(t,e){return s.encode(i.concat([i.from([e]),t]))}},"8zgK":function(t,e,r){"use strict";t.exports=function(t){return null!==t&&"object"==typeof t}},"G1u+":function(t,e,r){"use strict";e.a=function(t){if(!Array.isArray(t)||8!==t.length)throw new RangeError("invalid array length");for(var e=0,r=0;r<8;r++)t[7-r]&&(e|=1<<r);return e}},GCxg:function(t,e,r){"use strict";(function(t){var n=r("G1u+");e.a=function(e){for(var r=[0,0,0,0,0,0,0,0],s=t.alloc(Math.ceil(e.length/8)),i=0;i<s.length;i++){for(var o=0;o<8;o++)r[o]=e[8*i+o]?e[8*i+o]:0;s[i]=Object(n.a)(r)}return s}}).call(this,r("tjlA").Buffer)},"ILq/":function(t,e,r){"use strict";(function(t){e.a=function(e,r,n){void 0===n&&(n=!1);for(var s=n?r.length:e.length,i=t.alloc(s),o=0;o<s;o++)i[o]=~(e[n?o%e.length:o]|r[o]);return i}}).call(this,r("tjlA").Buffer)},L21C:function(t,e){const r={finalizePair:0,getAddresses:1290,sign:1090,getWallets:142,addAbiDefs:8,test:1646};let n=0;Object.keys(r).forEach(t=>{r[t]+82>n&&(n=r[t]+82)});const s={RESP_SUCCESS:0,RESP_ERR_INVALID_MSG:128,RESP_ERR_UNSUPPORTED_VER:129,RESP_ERR_DEV_BUSY:130,RESP_ERR_USER_TIMEOUT:131,RESP_ERR_USER_DECLINED:132,RESP_ERR_PAIR_FAIL:133,RESP_ERR_PAIR_DISABLED:134,RESP_ERR_PERMISSION_DISABLED:135,RESP_ERR_INTERNAL:136,RESP_ERR_GCE_TIMEOUT:137,RESP_ERR_WALLET_NOT_PRESENT:138,RESP_ERR_DEV_LOCKED:139,RESP_ERR_DISABLED:140,RESP_ERR_ALREADY:141};t.exports={getFwVersionConst:function(t){const e={reqMaxDataSz:1152};return 0===t.length||t[1]<10&&0===t[2]?(e.ethMaxDataSz=e.reqMaxDataSz-128,e.ethMaxMsgSz=e.ethMaxDataSz,e.ethMaxGasPrice=5e11,e.addrFlagsAllowed=!1):t[1]>=10&&t[2]>=0&&(e.reqMaxDataSz=1678,e.ethMaxDataSz=e.reqMaxDataSz-128,e.ethMaxMsgSz=e.ethMaxDataSz,e.ethMaxGasPrice=2e13,e.addrFlagsAllowed=!0),e},ADDR_STR_LEN:129,AES_IV:[109,121,115,101,99,114,101,116,112,97,115,115,119,111,114,100],BASE_URL:"https://signing.gridpl.us",ENC_MSG_LEN:n,addressSizes:{BTC:20,ETH:20},decResLengths:r,deviceCodes:{CONNECT:1,ENCRYPTED_REQUEST:2},encReqCodes:{FINALIZE_PAIRING:0,GET_ADDRESSES:1,ADD_PERMISSION:2,SIGN_TRANSACTION:3,GET_WALLETS:4,ADD_PERMISSION_V0:5,ADD_ABI_DEFS:6,TEST:7},ethMsgProtocol:{SIGN_PERSONAL:0},messageConstants:{NOT_PAIRED:0,PAIRED:1},responseCodes:s,responseMsgs:{[s.RESP_SUCCESS]:0,[s.RESP_ERR_INVALID_MSG]:"Invalid Request",[s.RESP_ERR_UNSUPPORTED_VER]:"Unsupported Version",[s.RESP_ERR_DEV_BUSY]:"Device Busy",[s.RESP_ERR_USER_TIMEOUT]:"Timeout Waiting for User",[s.RESP_ERR_USER_DECLINED]:"Request Declined by User",[s.RESP_ERR_PAIR_FAIL]:"Pairing Failed",[s.RESP_ERR_PAIR_DISABLED]:"Pairing is Currently Disabled",[s.RESP_ERR_PERMISSION_DISABLED]:"Automated Signing is Currently Disabled",[s.RESP_ERR_INTERNAL]:"Device Error",[s.RESP_ERR_GCE_TIMEOUT]:"Timeout",[s.RESP_ERR_WALLET_NOT_PRESENT]:"Incorrect Wallet UID Provided",[s.RESP_ERR_DEV_LOCKED]:"Device Locked",[s.RESP_ERR_DISABLED]:"Disabled",[s.RESP_ERR_ALREADY]:"Record already exists. You must first remove it on your device."},signingSchema:{BTC_TRANSFER:0,ETH_TRANSFER:1,ERC20_TRANSFER:2,ETH_MSG:3},REQUEST_TYPE_BYTE:2,VERSION_BYTE:1,HARDENED_OFFSET:2147483648,HANDLE_LARGER_CHAIN_ID:255,MAX_CHAIN_ID_BYTES:8,ETH_ABI_LATTICE_FW_TYPE_MAP:{address:1,bool:2,uint8:3,uint16:4,uint32:5,uint64:6,uint128:7,uint256:8,uint:15,bytes1:17,bytes2:18,bytes3:19,bytes4:20,bytes5:21,bytes6:22,bytes7:23,bytes8:24,bytes9:25,bytes10:26,bytes11:27,bytes12:28,bytes13:29,bytes14:30,bytes15:31,bytes16:32,bytes17:33,bytes18:34,bytes19:35,bytes20:36,bytes21:37,bytes22:38,bytes23:39,bytes24:40,bytes25:41,bytes26:42,bytes27:43,bytes28:44,bytes29:45,bytes30:46,bytes31:47,bytes32:48,bytes:49,string:50}}},PLHu:function(t,e,r){const{buildBitcoinTxRequest:n}=r("6WMX"),{buildEthereumTxRequest:s,buildEthereumMsgRequest:i,ensureHexBuffer:o}=r("xKF7"),a=r("tjlA").Buffer,l=r("cke4"),c=r("cC09"),u=r("MzeL"),{AES_IV:h,responseCodes:d,responseMsgs:f,VERSION_BYTE:p}=r("L21C"),g=new(0,u.ec)("p256");function y(t){return c.buf(t)>>>0}t.exports={isValidAssetPath:function(t){return[2147483697,2147483692].indexOf(t[0])>=0&&[2147483648,2147483649,2147483708].indexOf(t[1])>=0&&[2147483648].indexOf(t[2])>=0&&[0,1].indexOf(t[3])>=0},ensureHexBuffer:o,signReqResolver:{BTC:n,ETH:s,ETH_MSG:i},aes256_decrypt:function(t,e){const r=a.from(h),n=new l.ModeOfOperation.cbc(e,r);return a.from(n.decrypt(t))},aes256_encrypt:function(t,e){const r=a.from(h),n=new l.ModeOfOperation.cbc(e,r),s=t.length%16==0?t:l.padding.pkcs7.pad(t);return a.from(n.encrypt(s))},parseDER:function(t){if(48!==t[0]||2!==t[2])return null;let e=3;const r={r:null,s:null},n=t[e];if(e++,r.r=t.slice(e,e+n),e+=n,2!==t[e])return null;e++;const s=t[e];return e++,r.s=t.slice(e,e+s),r},checksum:y,parseLattice1Response:function(t){const e={err:null,data:null},r=a.from(t,"hex");let n=0;const s=r.readUInt8(n);if(n++,s!==p)return e.err="Incorrect protocol version. Please update your SDK",e;const i=r.readUInt8(n);if(n++,0!==i)return e.err="Incorrect response from Lattice1",e;r.readUInt32BE(n),n+=4;const o=r.readUInt16BE(n);n+=2;const l=r.slice(n,n+o);n+=o;const c=l.readUInt8(0);return c!==d.RESP_SUCCESS?(e.err=`Error from device: ${f[c]?f[c]:"Unknown Error"}`,e.responseCode=c,e):(e.data=l.slice(1,l.length),r.readUInt32BE(n)!==y(r.slice(0,r.length-4))?(e.err="Invalid checksum from device response",e.data=null,e):e)},getP256KeyPair:function(t){return g.keyFromPrivate(t,"hex")},getP256KeyPairFromPub:function(t){return g.keyFromPublic(t,"hex")},toPaddedDER:function(t){const e=a.alloc(74);return a.from(t.toDER()).copy(e),e}}},RP9m:function(t,e,r){const n=r("9lTW"),s=r("tjlA").Buffer;function i(t,e){if("00"===t.slice(0,2))throw new Error("invalid RLP: extra zeros");return parseInt(t,e)}function o(t,e){if(t<56)return new s([t+e]);var r=c(t),n=c(e+55+r.length/2);return new s(n+r,"hex")}function a(t){var e,r,n,o,l,c=[],u=t[0];if(u<=127)return{data:t.slice(0,1),remainder:t.slice(1)};if(u<=183){if(e=u-127,n=128===u?new s([]):t.slice(1,e),2===e&&n[0]<128)throw new Error("invalid rlp encoding: byte must be less 0x80");return{data:n,remainder:t.slice(e)}}if(u<=191){if(e=i(t.slice(1,r=u-182).toString("hex"),16),(n=t.slice(r,e+r)).length<e)throw new Error("invalid RLP");return{data:n,remainder:t.slice(e+r)}}if(u<=247){for(o=t.slice(1,e=u-191);o.length;)l=a(o),c.push(l.data),o=l.remainder;return{data:c,remainder:t.slice(e)}}var h=(r=u-246)+(e=i(t.slice(1,r).toString("hex"),16));if(h>t.length)throw new Error("invalid rlp: total length is larger than the data");if(0===(o=t.slice(r,h)).length)throw new Error("invalid rlp, List has a invalid length");for(;o.length;)l=a(o),c.push(l.data),o=l.remainder;return{data:c,remainder:t.slice(h)}}function l(t){return"0x"===t.slice(0,2)}function c(t){var e=t.toString(16);return e.length%2&&(e="0"+e),e}function u(t){if(!s.isBuffer(t))if("string"==typeof t)t=l(t)?new s(((r="string"!=typeof(n=t)?n:l(n)?n.slice(2):n).length%2&&(r="0"+r),r),"hex"):new s(t);else if("number"==typeof t)t?(e=c(t),t=new s(e,"hex")):t=new s([]);else if(null==t)t=new s([]);else{if(!t.toArray)throw new Error("invalid type");t=new s(t.toArray())}var e,r,n;return t}e.encode=function(t){if(t instanceof Array){for(var r=[],n=0;n<t.length;n++)r.push(e.encode(t[n]));var i=s.concat(r);return s.concat([o(i.length,192),i])}return 1===(t=u(t)).length&&t[0]<128?t:s.concat([o(t.length,128),t])},e.decode=function(t,e){if(!t||0===t.length)return new s([]);var r=a(t=u(t));return e?r:(n.equal(r.remainder.length,0,"invalid remainder"),r.data)},e.getLength=function(t){if(!t||0===t.length)return new s([]);var e=(t=u(t))[0];if(e<=127)return t.length;if(e<=183)return e-127;if(e<=191)return e-182;if(e<=247)return e-191;var r=e-246;return r+i(t.slice(1,r).toString("hex"),16)}},XUzR:function(t,e,r){"use strict";(function(t){e.a=function(e,r,n){void 0===n&&(n=!1);for(var s=n?r.length:e.length,i=t.alloc(s),o=0;o<s;o++)i[o]=e[n?o%e.length:o]&r[o];return i}}).call(this,r("tjlA").Buffer)},YnKP:function(t,e,r){"use strict";(function(t){e.a=function(e,r,n){void 0===n&&(n=!1);for(var s=n?r.length:e.length,i=t.alloc(s),o=0;o<s;o++)i[o]=e[n?o%e.length:o]|r[o];return i}}).call(this,r("tjlA").Buffer)},aFzb:function(t,e,r){(function(e){const n=r("HEbw"),s=r("+qE3").EventEmitter,i=r("4Mn8");class o extends s{constructor(t={}){super(),this.type="Lattice Hardware",this._resetDefaults(),this.deserialize(t)}deserialize(t={}){return t.creds&&(this.creds=t.creds),t.accounts&&(this.accounts=t.accounts),t.walletUID&&(this.walletUID=t.walletUID),t.name&&(this.name=t.name),t.network&&(this.network=t.network),Promise.resolve()}serialize(){return Promise.resolve({creds:this.creds,accounts:this.accounts,walletUID:this.walletUID,name:this.name,network:this.network})}isUnlocked(){return this._hasCreds()&&this._hasSession()}setHdPath(){console.warn("setHdPath not implemented.")}unlock(t=!0){return new Promise((e,r)=>{this._getCreds().then(t=>(t&&(this.creds.deviceID=t.deviceID,this.creds.password=t.password),this._initSession())).then(()=>this._connect(t)).then(()=>e("Unlocked")).catch(t=>r(new Error(t)))})}addAccounts(t=1){return new Promise((e,r)=>-1e3===t?(this.forgetDevice(),e([])):t<=0?r("Number of accounts to add must be a positive number."):void this.unlock().then(()=>this._fetchAddresses(t,this.unlockedAccount)).then(r=>(this.accounts.splice(this.unlockedAccount,t),this.accounts.splice(this.unlockedAccount,0,...r),e(this.accounts))).catch(t=>r(new Error(t))))}getAccounts(){return Promise.resolve(this.accounts?this.accounts.slice():[].slice())}signTransaction(t,r){return new Promise((n,s)=>{this._unlockAndFindAccount(t).then(t=>{const e={chainId:r.getChainId()||1,nonce:Number(`0x${r.nonce.toString("hex")}`)||0,gasPrice:Number(`0x${r.gasPrice.toString("hex")}`),gasLimit:Number(`0x${r.gasLimit.toString("hex")}`),to:`0x${r.to.toString("hex")}`,value:Number(`0x${r.value.toString("hex")}`),data:0===r.data.length?null:`0x${r.data.toString("hex")}`,signerPath:[2147483692,2147483708,2147483648,0,t]};return this._signTxData(e)}).then(t=>t.sig&&t.sig.v&&t.sig.r&&t.sig.s?(r.v=t.sig.v,r.r=e.from(t.sig.r,"hex"),r.s=e.from(t.sig.s,"hex"),n(r)):s(Error("No signature returned"))).catch(t=>s(new Error(t)))})}signPersonalMessage(t,e){return this.signMessage(t,{payload:e,protocol:"signPersonal"})}signMessage(t,e){return new Promise((r,n)=>{this._unlockAndFindAccount(t).then(t=>{const{payload:s,protocol:i}=e;if(!s||!i)return n("`payload` and `protocol` fields must be included in the request");const o={currency:"ETH_MSG",data:{protocol:i,payload:s,signerPath:[2147483692,2147483708,2147483648,0,t]}};if(!this._hasSession())return n("No SDK session started. Cannot sign transaction.");this.sdkSession.sign(o,(t,e)=>{if(t)return n(new Error(t));if(!e.sig)return n("No signature returned");let s=(e.sig.v-27).toString(16);return s.length<2&&(s=`0${s}`),r(`0x${e.sig.r}${e.sig.s}${s}`)})})})}exportAccount(t){return Promise.reject(Error("exportAccount not supported by this device"))}removeAccount(t){this.forgetDevice()}getFirstPage(){return this.page=0,this._getPage(1)}getNextPage(){return this.getFirstPage()}getPreviousPage(){return this.getFirstPage()}setAccountToUnlock(t){this.unlockedAccount=parseInt(t,10)}forgetDevice(){this._resetDefaults()}_unlockAndFindAccount(t){return new Promise((e,r)=>{this.unlock(!1).then(()=>this.getAccounts()).then(n=>{let s=null;return n.forEach((e,r)=>{t.toLowerCase()===e.toLowerCase()&&(s=r)}),null===s?r("Signer not present"):e(s)}).catch(t=>r(t))})}_resetDefaults(){this.accounts=[],this.isLocked=!0,this.creds={deviceID:null,password:null},this.walletUID=null,this.sdkSession=null,this.page=0,this.unlockedAccount=0,this.network=null}_getCreds(){return new Promise((t,e)=>{if(this._hasCreds())return t();const r=this.name?this.name:"Unknown";let n="https://wallet.gridplus.io";switch(this.network){case"rinkeby":n="https://gridplus-web-wallet-dev.herokuapp.com"}let s=`${n}?keyring=${r}`;this.network&&(s+=`&network=${this.network}`),window.open(s).postMessage("GET_LATTICE_CREDS",n),window.addEventListener("message",function(r){if(r.origin===n)try{const n=JSON.parse(r.data);return n.deviceID&&n.password?t(n):e(Error("Invalid credentials returned from Lattice."))}catch(s){return e(s)}},!1)})}_connect(t){return new Promise((e,r)=>{this.sdkSession.connect(this.creds.deviceID,n=>{if(n)return r(n);const s=this.sdkSession.getActiveWallet();if(!s||!s.uid)return r("No active wallet");const i=s.uid.toString("hex");if(i!=this.walletUID){if(!1===t)return r("Wallet has changed! Please reconnect.");this.accounts=[],this.walletUID=i}return e()})})}_initSession(){return new Promise((t,e)=>{if(this._hasSession())return t();try{let e="https://signing.gridpl.us";this.network&&"mainnet"!==this.network&&(e="https://signing.staging-gridpl.us");const r={name:this.name,baseUrl:e,crypto:n,timeout:12e4,privKey:this._genSessionKey(),network:this.network};return this.sdkSession=new i.Client(r),t()}catch(r){return e(r)}})}_fetchAddresses(t=1,e=0){return new Promise((r,n)=>this._hasSession()?e>this.accounts.length?n(`Requested address is out of bounds. You may only request index <${this.accounts.length}`):this.accounts.length>e?r(this.accounts.slice(e,t)):void this.sdkSession.getAddresses({currency:"ETH",startPath:[2147483692,2147483708,2147483648,0,e],n:t},(t,e)=>t?n(Error(`Error getting addresses: ${t}`)):e.length<1?n("No addresses returned"):r(e)):n("No SDK session started. Cannot fetch addresses."))}_signTxData(t){return new Promise((e,r)=>{if(!this._hasSession())return r("No SDK session started. Cannot sign transaction.");this.sdkSession.sign({currency:"ETH",data:t},(t,n)=>t?r(t):n.tx?e(n):r("No transaction payload returned."))})}_getPage(t=1){return new Promise((e,r)=>{this.page+=t,this.page<=0&&(this.page=1);const n=5*(this.page-1);this.unlock().then(()=>this._fetchAddresses(1,0)).then(t=>{const r=[];return t.forEach((t,e)=>{r.push({address:t,balance:null,index:n+e})}),e(r)}).catch(t=>r(t))})}_hasCreds(){return null!==this.creds.deviceID&&null!==this.creds.password&&this.name}_hasSession(){return this.sdkSession&&this.walletUID}_genSessionKey(){if(!this._hasCreds())throw new Error("No credentials -- cannot create session key!");const t=e.concat([e.from(this.creds.password),e.from(this.creds.deviceID),e.from(this.name)]);return n.createHash("sha256").update(t).digest()}}o.type="Lattice Hardware",t.exports=o}).call(this,r("tjlA").Buffer)},cC09:function(t,e,r){var n;n=function(t){t.version="1.2.0";var e=function(){for(var t=0,e=new Array(256),r=0;256!=r;++r)e[r]=t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=r)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1;return"undefined"!=typeof Int32Array?new Int32Array(e):e}();t.table=e,t.bstr=function(t,r){for(var n=-1^r,s=t.length-1,i=0;i<s;)n=(n=n>>>8^e[255&(n^t.charCodeAt(i++))])>>>8^e[255&(n^t.charCodeAt(i++))];return i===s&&(n=n>>>8^e[255&(n^t.charCodeAt(i))]),-1^n},t.buf=function(t,r){if(t.length>1e4)return function(t,r){for(var n=-1^r,s=t.length-7,i=0;i<s;)n=(n=(n=(n=(n=(n=(n=(n=n>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])];for(;i<s+7;)n=n>>>8^e[255&(n^t[i++])];return-1^n}(t,r);for(var n=-1^r,s=t.length-3,i=0;i<s;)n=(n=(n=(n=n>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])])>>>8^e[255&(n^t[i++])];for(;i<s+3;)n=n>>>8^e[255&(n^t[i++])];return-1^n},t.str=function(t,r){for(var n,s,i=-1^r,o=0,a=t.length;o<a;)(n=t.charCodeAt(o++))<128?i=i>>>8^e[255&(i^n)]:n<2048?i=(i=i>>>8^e[255&(i^(192|n>>6&31))])>>>8^e[255&(i^(128|63&n))]:n>=55296&&n<57344?(n=64+(1023&n),s=1023&t.charCodeAt(o++),i=(i=(i=(i=i>>>8^e[255&(i^(240|n>>8&7))])>>>8^e[255&(i^(128|n>>2&63))])>>>8^e[255&(i^(128|s>>6&15|(3&n)<<4))])>>>8^e[255&(i^(128|63&s))]):i=(i=(i=i>>>8^e[255&(i^(224|n>>12&15))])>>>8^e[255&(i^(128|n>>6&63))])>>>8^e[255&(i^(128|63&n))];return-1^i}},"undefined"==typeof DO_NOT_EXPORT_CRC?n(e):n({})},cpc2:function(t,e,r){function n(t){if(t)return function(t){for(var e in n.prototype)t[e]=n.prototype[e];return t}(t)}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},n.prototype.once=function(t,e){function r(){this.off(t,r),e.apply(this,arguments)}return r.fn=e,this.on(t,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var s=0;s<n.length;s++)if((r=n[s])===e||r.fn===e){n.splice(s,1);break}return 0===n.length&&delete this._callbacks["$"+t],this},n.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),r=this._callbacks["$"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(r){n=0;for(var s=(r=r.slice(0)).length;n<s;++n)r[n].apply(this,e)}return this},n.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},n.prototype.hasListeners=function(t){return!!this.listeners(t).length}},f7RY:function(t,e,r){"use strict";(function(t){e.a=function(e){for(var r=t.alloc(e.length),n=0;n<e.length;n++)r[n]=~e[n];return r}}).call(this,r("tjlA").Buffer)},kMlx:function(t,e,r){"use strict";var n=r("8zgK");function s(t){if(t)return function(t){for(var e in s.prototype)t[e]=s.prototype[e];return t}(t)}t.exports=s,s.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,this},s.prototype.parse=function(t){return this._parser=t,this},s.prototype.responseType=function(t){return this._responseType=t,this},s.prototype.serialize=function(t){return this._serializer=t,this},s.prototype.timeout=function(t){if(!t||"object"!=typeof t)return this._timeout=t,this._responseTimeout=0,this;for(var e in t)switch(e){case"deadline":this._timeout=t.deadline;break;case"response":this._responseTimeout=t.response;break;default:console.warn("Unknown timeout option",e)}return this},s.prototype.retry=function(t,e){return 0!==arguments.length&&!0!==t||(t=1),t<=0&&(t=0),this._maxRetries=t,this._retries=0,this._retryCallback=e,this};var i=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];s.prototype._shouldRetry=function(t,e){if(!this._maxRetries||this._retries++>=this._maxRetries)return!1;if(this._retryCallback)try{var r=this._retryCallback(t,e);if(!0===r)return!0;if(!1===r)return!1}catch(n){console.error(n)}if(e&&e.status&&e.status>=500&&501!=e.status)return!0;if(t){if(t.code&&~i.indexOf(t.code))return!0;if(t.timeout&&"ECONNABORTED"==t.code)return!0;if(t.crossDomain)return!0}return!1},s.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this._end()},s.prototype.then=function(t,e){if(!this._fullfilledPromise){var r=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise(function(t,e){r.end(function(r,n){r?e(r):t(n)})})}return this._fullfilledPromise.then(t,e)},s.prototype.catch=function(t){return this.then(void 0,t)},s.prototype.use=function(t){return t(this),this},s.prototype.ok=function(t){if("function"!=typeof t)throw Error("Callback required");return this._okCallback=t,this},s.prototype._isResponseOK=function(t){return!!t&&(this._okCallback?this._okCallback(t):t.status>=200&&t.status<300)},s.prototype.getHeader=s.prototype.get=function(t){return this._header[t.toLowerCase()]},s.prototype.set=function(t,e){if(n(t)){for(var r in t)this.set(r,t[r]);return this}return this._header[t.toLowerCase()]=e,this.header[t]=e,this},s.prototype.unset=function(t){return delete this._header[t.toLowerCase()],delete this.header[t],this},s.prototype.field=function(t,e){if(null==t)throw new Error(".field(name, val) name can not be empty");if(this._data&&console.error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()"),n(t)){for(var r in t)this.field(r,t[r]);return this}if(Array.isArray(e)){for(var s in e)this.field(t,e[s]);return this}if(null==e)throw new Error(".field(name, val) val can not be empty");return"boolean"==typeof e&&(e=""+e),this._getFormData().append(t,e),this},s.prototype.abort=function(){return this._aborted||(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort")),this},s.prototype._auth=function(t,e,r,n){switch(r.type){case"basic":this.set("Authorization","Basic "+n(t+":"+e));break;case"auto":this.username=t,this.password=e;break;case"bearer":this.set("Authorization","Bearer "+t)}return this},s.prototype.withCredentials=function(t){return null==t&&(t=!0),this._withCredentials=t,this},s.prototype.redirects=function(t){return this._maxRedirects=t,this},s.prototype.maxResponseSize=function(t){if("number"!=typeof t)throw TypeError("Invalid argument");return this._maxResponseSize=t,this},s.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},s.prototype.send=function(t){var e=n(t),r=this._header["content-type"];if(this._formData&&console.error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()"),e&&!this._data)Array.isArray(t)?this._data=[]:this._isHost(t)||(this._data={});else if(t&&this._data&&this._isHost(this._data))throw Error("Can't merge these send calls");if(e&&n(this._data))for(var s in t)this._data[s]=t[s];else"string"==typeof t?(r||this.type("form"),this._data="application/x-www-form-urlencoded"==(r=this._header["content-type"])?this._data?this._data+"&"+t:t:(this._data||"")+t):this._data=t;return!e||this._isHost(t)||r||this.type("json"),this},s.prototype.sortQuery=function(t){return this._sort=void 0===t||t,this},s.prototype._finalizeQueryString=function(){var t=this._query.join("&");if(t&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+t),this._query.length=0,this._sort){var e=this.url.indexOf("?");if(e>=0){var r=this.url.substring(e+1).split("&");"function"==typeof this._sort?r.sort(this._sort):r.sort(),this.url=this.url.substring(0,e)+"?"+r.join("&")}}},s.prototype._appendQueryString=function(){console.trace("Unsupported")},s.prototype._timeoutError=function(t,e,r){if(!this._aborted){var n=new Error(t+e+"ms exceeded");n.timeout=e,n.code="ECONNABORTED",n.errno=r,this.timedout=!0,this.abort(),this.callback(n)}},s.prototype._setTimeouts=function(){var t=this;this._timeout&&!this._timer&&(this._timer=setTimeout(function(){t._timeoutError("Timeout of ",t._timeout,"ETIME")},this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout(function(){t._timeoutError("Response timeout of ",t._responseTimeout,"ETIMEDOUT")},this._responseTimeout))}},nMdu:function(t,e,r){"use strict";(function(t){e.a=function(e,r,n){void 0===n&&(n=!1);for(var s=n?r.length:e.length,i=t.alloc(s),o=0;o<s;o++)i[o]=~(e[n?o%e.length:o]&r[o]);return i}}).call(this,r("tjlA").Buffer)},nZbv:function(t,e){function r(){this._defaults=[]}["use","on","once","set","query","type","accept","auth","withCredentials","sortQuery","retry","ok","redirects","timeout","buffer","serialize","parse","ca","key","pfx","cert"].forEach(function(t){r.prototype[t]=function(){return this._defaults.push({fn:t,arguments}),this}}),r.prototype._setDefaults=function(t){this._defaults.forEach(function(e){t[e.fn].apply(t,e.arguments)})},t.exports=r},oHnp:function(t,e,r){"use strict";e.type=function(t){return t.split(/ *; */).shift()},e.params=function(t){return t.split(/ *; */).reduce(function(t,e){var r=e.split(/ *= */),n=r.shift(),s=r.shift();return n&&s&&(t[n]=s),t},{})},e.parseLinks=function(t){return t.split(/ *, */).reduce(function(t,e){var r=e.split(/ *; */),n=r[0].slice(1,-1);return t[r[1].split(/ *= */)[1].slice(1,-1)]=n,t},{})},e.cleanHeader=function(t,e){return delete t["content-type"],delete t["content-length"],delete t["transfer-encoding"],delete t.host,e&&(delete t.authorization,delete t.cookie),t}},pzNo:function(t,e,r){const n=r("2k3W"),s=r("24Ii"),i=r("6WMX"),o=r("xKF7"),{buildAddAbiPayload:a,abiParsers:l,MAX_ABI_DEFS:c}=r("u0zn"),{isValidAssetPath:u,signReqResolver:h,aes256_decrypt:d,aes256_encrypt:f,parseDER:p,checksum:g,ensureHexBuffer:y,getP256KeyPair:E,getP256KeyPairFromPub:_,parseLattice1Response:m,toPaddedDER:w}=r("PLHu"),{getFwVersionConst:v,ADDR_STR_LEN:R,ENC_MSG_LEN:S,decResLengths:b,deviceCodes:I,encReqCodes:T,responseCodes:x,REQUEST_TYPE_BYTE:A,VERSION_BYTE:P,messageConstants:D,BASE_URL:U}=r("L21C"),C=r("tjlA").Buffer,k=C.alloc(32);t.exports=class{constructor({baseUrl:t,crypto:e,name:r,privKey:n,timeout:s,retryCount:i}={}){if(r&&r.length>24)throw new Error("name must be less than 24 characters");if(!e)throw new Error("crypto provider is required");this.baseUrl=t||U,this.crypto=e,this.name=r||"Unknown",this.privKey=n||this.crypto.randomBytes(32),this.key=E(this.privKey),this.ephemeralPub=null,this.sharedSecret=null,this.timeout=s||6e4,this.deviceId=null,this.isPaired=!1,this.retryCount=i||3,this.activeWallets={internal:{uid:k,name:null,capabilities:null,external:!1},external:{uid:k,name:null,capabilities:null,external:!0}}}connect(t,e){if("function"==typeof t){if(!this.deviceId)return e("No device ID has been stored. Please connect with your device ID first.");e=t}else this.deviceId=t;const r=this._buildRequest(I.CONNECT,this.pubKeyBytes());this._request(r,(t,r)=>t?e(t):(this.isPaired=this._handleConnect(r),this.isPaired?void this._getActiveWallet(t=>e(t,this.isPaired),!0):e(null)))}pair(t,e){const r=this.pubKeyBytes(),n=C.alloc(25);if(this.name.length>24)return e("Name is too many characters. Please change it to <25 characters.");n.write(this.name);const s=C.concat([r,n,C.from(t)]),i=this.crypto.createHash("sha256").update(s).digest(),o=this.key.sign(i),a=w(o),l=C.concat([n,a]),c=this._buildEncRequest(T.FINALIZE_PAIRING,l);this._request(c,(t,r)=>{if(t)return e(t);const n=this._handlePair(r);if(n)return e(n);this._getActiveWallet(t=>t?e(t):e(null,this.hasActiveWallet()),!0)})}test(t,e){if(!t.payload)return e("First argument must contain `testID` and `payload` fields.");const r=C.alloc(506);r.writeUInt32BE(t.testID,0),r.writeUInt16BE(t.payload.length,4),t.payload.copy(r,6);const n=this._buildEncRequest(T.TEST,r);this._request(n,(t,r)=>{if(t)return e(t);const n=this._handleEncResponse(r,b.test);return null!==n.err?e(n.err):e(null,n.data.slice(65))})}getAddresses(t,e){const{startPath:r,n:s,skipCache:i=!0}=t;if(void 0===r||void 0===s||5!==r.length)return e("Please provide `startPath` and `n` options");if(s>10)return e("You may only request 10 addresses at once.");if(!0===i&&!1===u(r))return e("Parent path is not supported");const o=C.alloc(33+4*r.length);let a=0;const l=this.getActiveWallet();if(null===l)return e("No active wallet.");l.uid.copy(o,a),a+=32;for(let n=0;n<r.length;n++)o.writeUInt32BE(r[n],a),a+=4;let c;if(!0===v(this.fwVersion).addrFlagsAllowed){const t=n.nibble.read(!0===i?1:0),e=n.nibble.read(s);c=n.byte.write(t.concat(e))}else c=s;o.writeUInt8(c,a),a++;const h=this._buildEncRequest(T.GET_ADDRESSES,o);return this._request(h,(t,r)=>{if(t)return e(t);const n=this._handleGetAddresses(r);return n.err?e(n.err):e(null,n.data)})}sign(t,e){const{currency:r,data:n}=t;if(void 0===r||void 0===n)return e("Please provide `currency` and `data` options");if(void 0===h[r])return e("Unsupported currency");const s=v(this.fwVersion);n.ethMaxDataSz=s.ethMaxDataSz,n.ethMaxMsgSz=s.ethMaxMsgSz;const i=h[r](n);if(void 0!==i.err)return e({err:i.err});if(i.payload.length>s.reqMaxDataSz)return e("Transaction is too large");const o=C.alloc(2+s.reqMaxDataSz);let a=0;o.writeUInt16BE(i.schema,a),a+=2;const l=this.getActiveWallet();if(null===l)return e("No active wallet.");l.uid.copy(o,a),a+=l.uid.length,i.payload.copy(o,a);const c=this._buildEncRequest(T.SIGN_TRANSACTION,o);return this._request(c,(n,s,o)=>{if(o===x.RESP_ERR_WALLET_NOT_PRESENT)this._getActiveWallet(r=>r?e(r):this.sign(t,e));else{if(!n){const t=this._handleSign(s,r,i);return e(t.err,t.data)}if(n)return e(n)}})}addAbiDefs(t,e,r=null){const n=t.slice(0,c);let s;t=t.slice(c);try{s=a(n)}catch(l){return e(l)}const i=C.alloc(s.length+10);i.writeUInt16LE(t.length),null!==r&&r.copy(i,2),s.copy(i,10);const o=this._buildEncRequest(T.ADD_ABI_DEFS,i);return this._request(o,(n,s,i)=>{if(i&&i!==x.RESP_SUCCESS)return e("Error making request.");if(n)return e(n);const o=this._handleEncResponse(s,b.addAbiDefs);if(r=o.data.slice(65,73),0===t.length)return e(null);this.addAbiDefs(t,e,r,t)})}addPermissionV0(t,e){const{currency:r,timeWindow:n,limit:s,decimals:i,asset:o}=t;if(!r||void 0===n||void 0===s||void 0===i||null===n||null===s||null===i)return e("currency, timeWindow, decimals, and limit are all required options.");if(0===n||0===s)return e("Time window and spending limit must be positive.");let a=r;o&&(a+=`_${o}`);const l=C.alloc(293);if(C.from(a).length>255)return e("Asset name too long.");C.from(a).copy(l,0);const c=y(s);if(c.length>32)return e("Limit too large.");c.copy(l,32-c.length+256),l.writeUInt32BE(n,288),l.writeUInt8(i,292);const u=this._buildEncRequest(T.ADD_PERMISSION_V0,l);return this._request(u,(r,n,s)=>{if(s===x.RESP_ERR_WALLET_NOT_PRESENT)this._getActiveWallet(r=>r?e(r):this.addPermissionV0(t,e));else{if(!r){const t=this._handleEncResponse(n,b.finalizePair);return e(t.err?t.err:null)}if(r)return e(r)}})}_getActiveWallet(t,e=!1){if(!0===e||!0!==this.hasActiveWallet()&&!0===this.isPaired){const e=C.alloc(0),r=this._buildEncRequest(T.GET_WALLETS,e);return this._request(r,(e,r)=>e?(this._resetActiveWallets(),t(e)):t(this._handleGetWallets(r)))}return t(null)}_getSharedSecret(){return C.from(this.key.derive(this.ephemeralPub.getPublic()).toArray("be",32))}_getEphemId(){if(null===this.ephemeralPub)return null;const t=this._getSharedSecret();return this.crypto.createHash("sha256").update(t).digest().slice(0,4)}_buildEncRequest(t,e){const r=parseInt(this._getEphemId().toString("hex"),16),n=C.concat([C.from([t]),e]),s=g(n),i=C.alloc(n.length+4);n.copy(i,0),i.writeUInt32LE(s,n.length);const o=this._getSharedSecret(),a=f(i,o),l=C.alloc(S+4);return l.writeUInt32LE(r,0),a.copy(l,4),this._buildRequest(I.ENCRYPTED_REQUEST,l)}_buildRequest(t,e){let r=e&&C.isBuffer(e)?e.length+1:1;t===I.ENCRYPTED_REQUEST&&(r=1+e.length);let n=0;const s=C.alloc(r+8);n=s.writeUInt8(P,n),n=s.writeUInt8(A,n);const i=this.crypto.randomBytes(4);n=s.writeUInt32BE(parseInt(`0x${i.toString("hex")}`),n),n=s.writeUInt16BE(r,n),n=s.writeUInt8(t,n),r>1&&(n=e.copy(s,n));const o=g(s),a=C.alloc(s.length+4);return n=s.copy(a),a.writeUInt32BE(o,n),a}_request(t,e,r=this.retryCount){if(!this.deviceId)return e("Serial is not set. Please set it and try again.");s.post(`${this.baseUrl}/${this.deviceId}`).timeout(this.timeout).send({data:t}).then(n=>{if(!n||!n.body)return e(`Invalid response: ${n}`);if(200!==n.body.status)return e(`Error code ${n.body.status}: ${n.body.message}`);const s=m(n.body.message);return(s.responseCode===x.RESP_ERR_DEV_BUSY||s.responseCode===x.RESP_ERR_GCE_TIMEOUT)&&r>0?setTimeout(()=>{this._request(t,e,r-1)},3e3):(s.responseCode===x.RESP_ERR_WALLET_NOT_PRESENT&&this._resetActiveWallets(),s.err?e(s.err):e(null,s.data,s.responseCode))}).catch(t=>e("ECONNABORTED"===t.code&&"ETIME"===t.errno?"Timeout waiting for device. Please ensure it is connected to the internet and try again in a minute.":"Failed to make request to device."))}_handleConnect(t){let e=0;const r=t.readUInt8(e);e++;const n=t.slice(e,e+65).toString("hex");return e+=65,this.fwVersion=t.slice(e,e+4),this.ephemeralPub=_(n),r===D.PAIRED}_handleEncResponse(t,e){const r=this._getSharedSecret(),n=t.slice(0,S),s=d(n,r),i=s.slice(0,e+=65),o=parseInt(`0x${s.slice(e,e+4).toString("hex")}`),a=g(i);if(o!==a)return{err:`Checksum mismatch in response from Lattice (calculated ${a}, wanted ${o})`};const l=s.slice(0,65).toString("hex");try{return this.ephemeralPub=_(l),{err:null,data:s}}catch(c){return{err:`Error handling getAddresses response: ${c.toString()}`}}}_handlePair(t){const e=this._handleEncResponse(t,b.finalizePair);return e.err?e.err:(this.pairingSalt=null,this.isPaired=!0,null)}_handleGetAddresses(t){const e=this._handleEncResponse(t,b.getAddresses);if(null!==e.err)return e;const r=e.data;let n=65;const s=[];for(;n+4<b.getAddresses;){const t=r.slice(n,n+R);n+=R;const e=t.indexOf(0);e>0&&s.push(t.slice(0,e).toString())}return{data:s,err:null}}_handleGetWallets(t){const e=this._handleEncResponse(t,b.getWallets);if(null!==e.err)return e;const r=e.data;let n,s=65,i=!1;return n=r.slice(s,s+32),this.activeWallets.internal.uid=n,this.activeWallets.internal.capabilities=r.readUInt32BE(s+32),this.activeWallets.internal.name=r.slice(s+36,s+71),n.equals(k)||(i=!0),s+=71,n=r.slice(s,s+32),this.activeWallets.external.uid=n,this.activeWallets.external.capabilities=r.readUInt32BE(s+32),this.activeWallets.external.name=r.slice(s+36,s+71),n.equals(k)||(i=!0),!0===i?null:"No active wallet."}_handleSign(t,e,r=null){const n=this._handleEncResponse(t,b.sign);if(null!==n.err)return{err:n.err};let s=65;const a=n.data;let l;if("BTC"===e){const t=i.addressVersion[r.changeData.changeVersion],e=a.slice(s,s+20);s+=20,l=i.getBitcoinAddress(e,t)}const c={err:null,data:null};if("BTC"===e){const t=33,e=[],n=[];let o=0;for(;s<a.length&&48===a[s];)n.push(a.slice(s,s+2+a[s+1])),e.push(a.slice(o*t+825,(o+1)*t+825)),s+=74,o+=1;const u={inputs:[],outputs:[],isSegwitSpend:r.origData.isSegwit,network:r.origData.network,crypto:this.crypto};u.outputs.push({value:r.origData.value,recipient:r.origData.recipient}),r.changeData.value>0&&u.outputs.push({value:r.changeData.value,recipient:l});for(let s=0;s<n.length;s++)u.inputs.push({hash:r.origData.prevOuts[s].txHash,index:r.origData.prevOuts[s].index,sig:n[s],pubkey:e[s]});const h=i.serializeTx(u);let d=h;!0===u.isSegwitSpend&&(u.isSegwitSpend=!1,d=i.serializeTx(u));let f=this.crypto.createHash("sha256").update(C.from(d,"hex")).digest();f=this.crypto.createHash("sha256").update(f).digest().reverse().toString("hex"),c.data={tx:h,txHash:f,changeRecipient:l,sigs:n}}else if("ETH"===e){const t=p(a.slice(s,s+2+a[s+1]));s+=74;const e=a.slice(s,s+20),n=o.buildEthRawTx(r,t,e,r.useEIP155);c.data={tx:`0x${n}`,txHash:`0x${o.hashTransaction(n)}`,sig:{v:t.v,r:t.r.toString("hex"),s:t.s.toString("hex")},signer:e}}else if("ETH_MSG"===e){const t=p(a.slice(s,s+2+a[s+1]));s+=74;const e=a.slice(s,s+20),n=o.validateEthereumMsgResponse({signer:e,sig:t},r);c.data={sig:{v:n.v,r:n.r.toString("hex"),s:n.s.toString("hex")},signer:e}}return c}_resetActiveWallets(){this.activeWallets.internal.uid=k,this.activeWallets.internal.name=null,this.activeWallets.internal.capabilities=null,this.activeWallets.external.uid=k,this.activeWallets.external.name=null,this.activeWallets.external.capabilities=null}getActiveWallet(){return k.equals(this.activeWallets.external.uid)?k.equals(this.activeWallets.internal.uid)?null:this.activeWallets.internal:this.activeWallets.external}hasActiveWallet(){return null!==this.getActiveWallet()}pubKeyBytes(t=!1){const e=this.key.getPublic().encode("hex"),r=C.from(e,"hex");if(!0===t){const t=r.slice(1,33).reverse(),e=r.slice(33,65).reverse();return C.concat([r[0],t,e])}return r}parseAbi(t,e){switch(t){case"etherscan":return l[t](e);default:return{err:`No ${t} parser available.`}}}}},u0zn:function(t,e,r){const n=r("tjlA").Buffer,s=r("HFX+").keccak256,{ETH_ABI_LATTICE_FW_TYPE_MAP:i}=r("L21C");e.MAX_ABI_DEFS=2,e.buildAddAbiPayload=function(t){if(!t||!Array.isArray(t))throw new Error("Missing definitions.");if(t.length>e.MAX_ABI_DEFS)throw new Error("You may only add 2 ABI definitions per request.");const r=n.alloc(1147);let s=0;return r.writeUInt8(t.length,s),s++,t.forEach(t=>{if(!t.sig||!t.name||!t.params)throw new Error("name, sig, and params must be present for every ABI definition.");const e=n.from(t.sig,"hex");if(4!==e.length)throw new Error("Function signatures must always be four bytes.");if(e.copy(r,s),s+=e.length,n.from(t.name).length>99)throw new Error("Only function names shorter than 100 characters are supported.");n.from(t.name).slice(0,100).copy(r,s),s+=100;const i=Array.isArray(t.params)?t.params.length:0;if(r.writeUInt8(i,s),s++,i>18)throw new Error("Currently only ABI defintions with <=10 parameters are supported.");i>0?(t.params.forEach(t=>{if(!t.name||!t.latticeTypeIdx||void 0===t.isArray||void 0===t.arraySz)throw new Error("name, latticeTypeIdx, isArray, and arraySz must be defined for all ABI params.");n.from(t.name).slice(0,20).copy(r,s),s+=20}),s+=20*(18-i),t.params.forEach(t=>{r.writeUInt8(t.latticeTypeIdx,s),s++,r.writeUInt8(!0===t.isArray,s),s++,r.writeUInt32LE(t.arraySz,s),s+=4}),s+=6*(18-i)):s+=468}),r},e.abiParsers={etherscan:function(t){const e=[];return t.forEach(t=>{if(t.name&&t.inputs&&"function"===t.type&&"view"!==t.stateMutability){const r=function(t){let e=`${t.name}(`;return t.inputs.forEach(t=>{e+=`${t.type},`}),t.inputs.length>0&&(e=e.slice(0,e.length-1)),e+=")",s(e).slice(0,8)}(t),n=function(t){const e=[];return t.forEach(t=>{const r=t.type,n={isArray:!1,arraySz:0,name:t.name},s=r.indexOf("["),o=r.indexOf("]");if(s>-1&&o>-1)if(s>=o);else if(s+1===o)n.isArray=!0;else{const t=parseInt(r.slice(s,o));if(isNaN(t))return n;n.isArray=!0,n.arraySz=t}const a=s>-1?r.slice(0,s):r;if(n.latticeTypeIdx=i[a],!n.latticeTypeIdx)throw new Error(`Unsupported type: ${r}`);e.push(n)}),e}(t.inputs);e.push({name:t.name,sig:r,params:n})}}),e}}},vGFC:function(t,e,r){"use strict";(function(t){e.a=function(e,r,n){void 0===n&&(n=!1);for(var s=n?r.length:e.length,i=t.alloc(s),o=0;o<s;o++)i[o]=~(e[n?o%e.length:o]^r[o]);return i}}).call(this,r("tjlA").Buffer)},xKF7:function(t,e,r){const n=r("kB5k"),s=r("tjlA").Buffer,i=r("L21C"),o=r("HFX+").keccak256,a=r("RP9m"),l=r("IzB8");function c(t){let e=t[0];for(;t.length>0&&"0"===e.toString();)e=(t=t.slice(1))[0];return t}function u(t,e,r,n,i){try{const a=new Uint8Array(s.from(o(t),"hex"));let c=0;const u=d(e.r,32);e.r=u;const p=d(e.s,32);e.s=p;const g=new Uint8Array(s.concat([u,p]));let y=l.ecdsaRecover(g,c,a,!1).slice(1);if(h(y)===r.toString("hex"))return e.v=f(c,i,n),e;if(c=1,y=l.ecdsaRecover(g,c,a,!1).slice(1),h(y)===r.toString("hex"))return e.v=f(c,i,n),e;throw new Error("Invalid Ethereum signature returned.")}catch(a){throw new Error(a)}}function h(t){return o(t).slice(-40)}function d(t,e){const r=s.alloc(e);return t.length<e?(t.copy(r,e-t.length),r):t.slice(-e)}function f(t,e,r){if(!1===e)return s.from(new n(t).plus(27).toString(16),"hex");const i=g(r);return E(new n(i.toString("hex"),16).times(2).plus(35).plus(t).toString(16))}e.buildEthereumMsgRequest=function(t){if(!t.payload||!t.protocol||!t.signerPath)throw new Error("You must provide `payload`, `signerPath`, and `protocol` arguments in the messsage request");const e={schema:i.signingSchema.ETH_MSG,payload:null,input:t,msg:null};if("signPersonal"===t.protocol){let n=0;e.payload=s.alloc(4*(t.signerPath.length+1)+t.ethMaxMsgSz+4),e.payload.writeUInt8(i.ethMsgProtocol.SIGN_PERSONAL,0),n+=1,e.payload.writeUInt32LE(t.signerPath.length,n),n+=4;for(let r=0;r<t.signerPath.length;r++)e.payload.writeUInt32LE(t.signerPath[r],n),n+=4;let o=t.payload,a=!1;if("string"==typeof t.payload)if("0x"===t.payload.slice(0,2))o=E(t.payload),a=!0===(r=t.payload.slice(2),/^[0-9a-fA-F]+$/.test(r));else{if(!1===function(t){for(let e=0;e<t.length;e++)if(t.charCodeAt(e)<32||t.charCodeAt(e)>127)return!1;return!0}(t.payload))throw new Error("Currently, the Lattice can only display ASCII strings.");o=s.from(t.payload)}else"boolean"==typeof t.displayHex&&(a=t.displayHex);if(e.msg=o,e.payload.writeUInt8(a,n),n+=1,e.payload.writeUInt16LE(o.length,n),n+=2,o.length>t.ethMaxMsgSz)throw new Error(`Your message is ${o.length} bytes, but can only be a maximum of ${t.ethMaxMsgSz}`);return o.copy(e.payload,n),e}throw new Error("Unsupported protocol");var r},e.validateEthereumMsgResponse=function(t,e){const{signer:r,sig:n}=t,{input:i,msg:o}=e;if("signPersonal"===i.protocol){const t=s.from(`\x19Ethereum Signed Message:\n${o.length.toString()}`,"utf-8");return u(s.concat([t,o]),n,r)}throw new Error("Unsupported protocol")},e.buildEthereumTxRequest=function(t){try{let{chainId:e=1}=t;const{signerPath:r,eip155:n=null,ethMaxDataSz:o}=t;if("number"!=typeof e&&!1===y(e)&&(e=p[e]),!e)throw new Error("Unsupported chain ID or name");if(!r||5!==r.length)throw new Error("Please provider full signer path (`signerPath`)");let a=function(t){switch(t){case 3:case 4:return!1;case 1:case 42:case 5:default:return!0}}(e);null!==n&&"boolean"==typeof n&&(a=n),t.value||(t.value=0);const l=[],c=E(t.nonce),u=E(t.gasPrice),h=E(t.gasLimit),d=E(t.to),f=E(t.value),_=E(t.data);l.push(c),l.push(u),l.push(h),l.push(d),l.push(f),l.push(_),!0===a&&(l.push(E(e)),l.push(E(null)),l.push(E(null)));const m=s.alloc(o+122);let w,v=0;m.writeUInt8(Number(a),v),v++;let R=0;if(!0===function(t){const e=g(t);return 1!==e.length||255===e.readUInt8(0)}(e)){if(w=g(e),R=w.length,R>i.MAX_CHAIN_ID_BYTES)throw new Error("ChainID provided is too large.");m.writeUInt8(i.HANDLE_LARGER_CHAIN_ID,v),v++}else{if(w=E(e),1!==w.length)throw new Error("Error parsing chainID");w.copy(m,v),v+=w.length}m.writeUInt32LE(r.length,v),v+=4;for(let t=0;t<r.length;t++)m.writeUInt32LE(r[t],v),v+=4;if(m.writeUInt32BE(t.nonce,v),v+=4,function(t,e,r){"number"==typeof t&&(t=t.toString(16));const n=s.alloc(8),i=t.length%2==0?t.toString(16):`0${t.toString(16)}`,o=s.from(i,"hex");o.copy(n,n.length-o.length),n.copy(e,r)}(t.gasPrice,m,v),v+=8,m.writeUInt32BE(t.gasLimit,v),v+=4,d.copy(m,v),v+=20,f.copy(m,v+32-f.length),v+=32,_&&_.length>o)return{err:`Data field too large (must be <=${o} bytes)`};if(m.writeUInt16BE(_.length,v),v+=2,_.length+R>o)throw new Error("Payload too large.");return R>0&&(m.writeUInt8(R,v),v++,w.copy(m,v),v+=R),_.copy(m,v),v+=o,{rawTx:l,payload:m,schema:i.signingSchema.ETH_TRANSFER,chainId:e,useEIP155:a,signerPath:r}}catch(e){return{err:e.message}}},e.buildEthRawTx=function(t,e,r,n=!0){const s=u(a.encode(t.rawTx),e,r,t.chainId,n),i=t.rawTx.slice(0,6);return i.push(s.v),i.push(c(s.r)),i.push(c(s.s)),a.encode(i).toString("hex")},e.addRecoveryParam=u,e.hashTransaction=function(t){return o(s.from(t,"hex"))};const p={mainnet:1,roptsten:3,rinkeby:4,kovan:42,goerli:5};function g(t){let e,r;if(e=!0===y(t)?E(t):E(new n(t).toString(16)),e.length>8)throw new Error("ChainID provided is too large.");return e.length<=2||4===e.length||8===e.length?e:(3===e.length?(r=s.alloc(4),r.writeUInt32BE(t)):e.length<=8&&(r=s.alloc(8),e.copy(r,8-e.length)),r)}function y(t){return!1===new n(t,16).isNaN()}function E(t){return null===t||0===t?s.alloc(0):(s.isBuffer(t)&&(t=t.toString("hex")),"number"==typeof t?t=`${t.toString(16)}`:"string"==typeof t&&"0x"===t.slice(0,2)&&(t=t.slice(2)),t.length%2>0&&(t=`0${t}`),s.from(t,"hex"))}e.chainIds=p,e.ensureHexBuffer=E}}]);